package main

import (
	"fmt"
	"strings"
	"testing"
)

func TestExampleTicking(t *testing.T) {
	input :=
		`.#.#...|#.
.....#|##|
.|..|...#.
..|#.....#
#.#|||#|#|
...#.||...
.|....|...
||...#|.#|
|.||||..|.
...#.|..|.`

	tests := []struct {
		nTicks   int
		expected string
	}{
		{
			1,
			`.......##.
......|###
.|..|...#.
..|#||...#
..##||.|#|
...#||||..
||...|||..
|||||.||.|
||||||||||
....||..|.`,
		},
		{
			2,
			`.......#..
......|#..
.|.|||....
..##|||..#
..###|||#|
...#|||||.
|||||||||.
||||||||||
||||||||||
.|||||||||`,
		},
		{
			3,
			`.......#..
....|||#..
.|.||||...
..###|||.#
...##|||#|
.||##|||||
||||||||||
||||||||||
||||||||||
||||||||||`,
		},
		{
			4,
			`.....|.#..
...||||#..
.|.#||||..
..###||||#
...###||#|
|||##|||||
||||||||||
||||||||||
||||||||||
||||||||||`,
		},
		{
			5,
			`....|||#..
...||||#..
.|.##||||.
..####|||#
.|.###||#|
|||###||||
||||||||||
||||||||||
||||||||||
||||||||||`,
		},
		{
			6,
			`...||||#..
...||||#..
.|.###|||.
..#.##|||#
|||#.##|#|
|||###||||
||||#|||||
||||||||||
||||||||||
||||||||||`,
		},
		{
			7,
			`...||||#..
..||#|##..
.|.####||.
||#..##||#
||##.##|#|
|||####|||
|||###||||
||||||||||
||||||||||
||||||||||`,
		},
		{
			8,
			`..||||##..
..|#####..
|||#####|.
||#...##|#
||##..###|
||##.###||
|||####|||
||||#|||||
||||||||||
||||||||||`,
		},
		{
			9,
			`..||###...
.||#####..
||##...##.
||#....###
|##....##|
||##..###|
||######||
|||###||||
||||||||||
||||||||||`,
		},
		{
			10,
			`.||##.....
||###.....
||##......
|##.....##
|##.....##
|##....##|
||##.####|
||#####|||
||||#|||||
||||||||||`,
		},
	}

	for _, tt := range tests {
		t.Run(fmt.Sprintf("%v", tt.nTicks), func(t *testing.T) {
			grid := parseGrid(strings.NewReader(input))

			for i := 0; i < tt.nTicks; i++ {
				grid = grid.tick()
			}

			if grid.String() != tt.expected {
				t.Errorf("Expected %v but was %v", tt.expected, grid.String())
			}
		})
	}

}

func TestExampleComponents(t *testing.T) {
	input :=
		`.#.#...|#.
.....#|##|
.|..|...#.
..|#.....#
#.#|||#|#|
...#.||...
.|....|...
||...#|.#|
|.||||..|.
...#.|..|.`

	grid := parseGrid(strings.NewReader(input))

	for t := 0; t < 10; t++ {
		grid = grid.tick()
	}

	fmt.Printf("%v\n", grid.String())

	trees, lumberyards := grid.status()

	if trees != 37 {
		t.Errorf("Expected %d trees but got %d", 37, trees)
	}

	if lumberyards != 31 {
		t.Errorf("Expected %d lumberyards but got %d", 31, lumberyards)
	}

	if grid.resourceValue() != 1147 {
		t.Errorf("Expected resource value of %d but got %d", 1147, grid.resourceValue())
	}
}
